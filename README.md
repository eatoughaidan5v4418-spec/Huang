# 智能健康坐垫 - 手机端 App

配合 HT32F52352 单片机智能健康坐垫系统的手机端应用，通过蓝牙串口透传与坐垫设备通信，实现实时坐姿监测、温湿度显示及远程设备控制。

## 功能特性

- **实时坐姿监测**：显示4路压力传感器数据、重心分布、坐姿状态判定（端正/左倾/右倾/跷二郎腿/前倾）
- **温湿度监控**：实时展示坐垫表面温度和湿度，支持历史趋势曲线
- **远程设备控制**：手机端开关加热丝和散热风扇，支持手动覆盖自动控制
- **阈值参数配置**：可调节温度/湿度阈值、久坐提醒时长、坐姿报警延迟
- **就座计时**：自动检测就座状态并计时，超时提醒起身运动
- **历史统计**：记录每次就座数据，展示坐姿健康统计

## 快速开始

### 环境要求

- Node.js 18+
- npm 或 yarn
- iOS 模拟器 / Android 模拟器 / 真机

### 安装依赖

```bash
npm install
```

### 启动项目

```bash
npx expo start
```

### 运行平台

- **Android**: 按 `a` 键或运行 `npm run android`
- **iOS**: 按 `i` 键或运行 `npm run ios`
- **Web**: 按 `w` 键或运行 `npm run web`

> 提示：App 内置演示模式，即使没有实际硬件设备也可查看模拟数据效果。

## 项目结构

```
SmartCushion/
├── app/                        # 页面路由 (Expo Router)
│   ├── _layout.tsx            # 根布局
│   └── (tabs)/                # 底部Tab页面
│       ├── _layout.tsx        # Tab导航布局
│       ├── index.tsx          # 监测页 - 实时仪表盘
│       ├── control.tsx        # 控制页 - 加热/散热开关
│       ├── statistics.tsx     # 统计页 - 历史数据分析
│       └── settings.tsx       # 设置页 - 阈值参数配置
├── store/                     # 状态管理
│   └── useCushionStore.ts     # Zustand Store (坐姿/传感器/设备控制)
├── services/                  # 服务层
│   └── bluetoothService.ts    # 蓝牙协议解析 & 模拟数据
├── constants/                 # 常量配置
│   ├── theme.ts               # NativeBase主题 & 配色
│   └── posture.ts             # 坐姿定义 & 蓝牙协议常量
├── types/                     # TypeScript类型定义
│   └── index.ts               # 全部类型导出
├── utils/                     # 工具函数
│   └── storage.ts             # AsyncStorage操作
├── App.tsx                    # 应用入口
└── package.json               # 依赖配置
```

## 技术栈

| 技术 | 用途 |
|------|------|
| React Native 0.73 | 移动端跨平台框架 |
| Expo 50 | 开发工具和运行时 |
| TypeScript | 类型安全 |
| NativeBase | UI组件库 |
| Zustand | 状态管理 (含AsyncStorage持久化) |
| React Native Chart Kit | 温湿度趋势图表 |
| Lucide React Native | 图标库 |

## 蓝牙通信协议

手机端与 HT32F52352 通过蓝牙串口透传模块通信，协议帧格式：

```
[帧头 0xAA] [命令字] [数据长度] [数据区...] [校验和] [帧尾 0x55]
```

### 上行命令（设备 -> 手机）
| 命令字 | 说明 | 数据格式 |
|--------|------|----------|
| 0x01 | 传感器数据上报 | 4x压力(2B) + 温度(1B) + 湿度(1B) |
| 0x02 | 设备状态上报 | 电量 + 加热状态 + 风扇状态 |
| 0x03 | 坐姿异常报警 | 坐姿类型码 |

### 下行命令（手机 -> 设备）
| 命令字 | 说明 |
|--------|------|
| 0x10 | 开启加热 |
| 0x11 | 关闭加热 |
| 0x12 | 开启风扇 |
| 0x13 | 关闭风扇 |
| 0x14 | 下发阈值参数 |

## 坐姿识别算法

基于"重心偏移比例"的轻量化姿态判别算法：

1. 计算4路传感器总压力，判断是否有人就座
2. 计算左/右半区压力占比和前/后半区压力占比
3. 阈值判定逻辑：
   - 单侧 > 75%：跷二郎腿
   - 前部 > 70%：过度前倾
   - 单侧 > 65%：重心侧倾
   - 其余：坐姿端正

## 许可证

MIT License
